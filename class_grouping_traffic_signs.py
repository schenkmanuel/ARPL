# Some classes will be grouped and ...

# ... subclassified in a second step, those are:

Halteverbote = ['Absolutes_Halteverbot_outdated',
                'Absolutes_Haltverbot_Mitte_Rechtsaufstellung_283-30',
                'Absolutes_Haltverbot_Anfang_Rechtsaufstellung_283-10',
                'Absolutes_Haltverbot_Ende_Rechtsaufstellung_283-20',
                'Absolutes_Haltverbot_Ende_Linksaufstellung_283-11',
                'Absolutes_Haltverbot_Anfang_Linksaufstellung_283-21',
                'Absolutes_Haltverbot_283',
                'Absolutes_Haltverbot_Mitte_Linksaufstellung_283-31',

                'Eingeschraenktes_Halteverbot_outdated',
                'Eingeschraenktes_Haltverbot_286',
                'Eingeschraenktes_Haltverbot_Mitte_Rechtsaufstellung_Verkehrsschild_286-30',
                'Eingeschraenktes_Haltverbot_Ende_Linksaufstellung_286-11',
                'Eingeschraenktes_Haltverbot_Anfang_Rechtsaufstellung_286-10',
                'Eingeschraenktes_Haltverbot_Anfang_Linksaufstellung_286-21',
                'Eingeschraenktes_Haltverbot_Ende_Rechtsaufstellung_286-20',
                'Eingeschraenktes Haltverbot_Mitte_Linksaufstellung_286-31',

                'Beginn_Halteverbot_zone_290.1']

Parken = ['Parken_outdated',
          'Parken_Ende_Rechtsaufstellung_oder_Parken_Anfang_Linksaufstellung_314-20',
          'Parken_314',
          'Parken_Mitte_Rechts_oder_Linksaufstellung_314-30',
          'Parkhaus_Parkgarage_314-50',
          'Parken_auf_Gehwegen_315',
          'Parken Anfang_Rechtsaufstellung_oder_Parken_Ende_Linksaufstellung_314-10',

          'Beginn_einer_Parkraumbewirtschaftungszone_314.1']

Ende_von_Restriktionen = ['Ende_des_Ueberholverbotes_fuer_Kraftfahrzeuge_mit_einer_zulaessigen_Gesamtmasse_ueber_3.5t_einschliesslich_ihrer_Anhaenger_und_Zugmaschinen_ausgenommen_PKW_und_Kraftomnibusse_281',
                          'Ende_der_zulaessigen_Hoechstgeschwindigkeit_30_km_h_278-30',
                          'Ende_der_zulaessigen_Hoechstgeschwindigkeit_50_km_h_278-50',
                          'Ende_der_zulaessigen_Hoechstgeschwindigkeit_70_km_h_278-70',
                          'Ende_der_zulaessigen_Hoechstgeschwindigkeit_80_km_h_278-80',
                          'Ende_saemtlicher_streckenbezogener_Geschwindigkeitsbeschraenkungen_und_Ueberholverbote_282',
                          'Ende_des_Ueberholverbotes_fuer_Kraftfahrzeuge_aller_Art_280']

Vorgeschriebene_Fahrtrichtung_Vorbeifahrt = ['Kreisverkehr_215',
                                             'Vorgeschriebene_Vorbeifahrt_rechts_222',
                                             'Vorgeschriebene_Fahrtrichtung_geradeaus_oder_rechts_214',
                                             'Vorgeschriebene Fahrtrichtung_geradeaus_oder_links_214-10',
                                             'Vorgeschriebene_Fahrtrichtung_rechts_209',
                                             'Vorgeschriebene_Fahrtrichtung_links_oder_rechts_214-30',
                                             'Vorgeschriebene_Vorbeifahrt_links_vorbei_222-10',
                                             'Vorgeschriebene_Fahrtrichtung_geradeaus_209-30',
                                             'Vorgeschriebene_Fahrtrichtung_hier_links_211-10',
                                             'Vorgeschriebene_Fahrtrichtung links_209-10',
                                             'Vorgeschriebene_Fahrtrichtung_hier_rechts_211']

Vorfahrtstrasse = ['Vorfahrtstrasse_306',
                   'Ende_der_Vorfahrtstrasse_307']

# ... not subclassified in a second step, (most of them are only mirrored signs), those are:

Doppelkurve = ['Doppelkurve_zunaechst_rechts_105-20',
               'Doppelkurve_zunaechst_links_105-10']

Einbahnstrasse = ['Einbahnstrasse_rechts_220-20',
                  'Einbahnstrasse_links_220-10']

Verengte_Fahrbahn = ['Verengte_Fahrbahn_120',
                     'Einseitig_verengte_Fahrbahn_Verengung_rechts_121-10',
                     'Einseitig_verengte_Fahrbahn_Verengung_links_121-20']

Fussgaengerueberweg_blau = ['Fussgaengerueberweg_Aufstellung_rechts_350-10',
                            'Fussgaengerueberweg_Aufstellung_links_350-20']

Fussgaengerueberweg_rot = ['Fussgaengerueberweg_Aufstellung_rechts_101-11',
                           'Fussgaengerueberweg_Aufstellung_links_101-21']

Gemeinsamer_Geh_Radweg = ['Gemeinsamer_Geh_Radweg_240',
                          'Gemeinsamer_Geh_Radweg_Fahrrad_oben']

Getrennter_Rad_und_Gehweg_Radweg = ['Getrennter_Rad_und_Gehweg_Radweg_rechts_241-31',
                                    'Getrennter_Rad_und_Gehweg_Radweg_links_241-30']

Kinder = ['Kinder_Aufstellung_rechts_136-10',
          'Kinder_Aufstellung_links_136-20']

Kurve = ['Kurve_rechts_103-20',
         'Kurve_links_103-10']

Ortstafel = ['Ortstafel_Vorderseite_310',
             'Ortstafel_Rueckseite_weiss_gelb',
             'Ortstafel_Rueckseite_ohne_naechste_Stadt',
             'Ortstafel_Rueckseite_311']

Radverkehr = ['Radverkehr_Aufstellung_rechts_138-10',
              'Radverkehr_Aufstellung_links_138-20']
Sackgasse = ['Sackgasse_357',
             'Sackgasse_fuer_Fussgaenger_durchlaessig_357-51',
             'Sackgasse_fuer_Radverkehr_und_Fussgaenger_durchlaessig_357-50']

Wildwechsel = ['Wildwechsel_Aufstellung_rechts_142-10',
               'Wildwechsel_Aufstellung_links_142-20']

Leitpfosten = ['Leitpfosten_rechts_620-40', 'Leitpfosten_links_620-41']


# all other classes
known_classes_not_grouped = ['Ende_einer_Tempo_30_Zone_274.2', 'Fussgaenger_Aufstellung_rechts_133-10',
                             'Ende_Halteverbot_zone_290.2',
                             'Ueberholverbot_fuer_Kraftfahrzeuge_aller_Art_276',
                             'Allgemeine_Gefahrenstelle_101', 'Radweg_nicht_StVO',
                             'Beginn_einer_Tempo_30_Zone_274.1', 'Verbot_der_Einfahrt_267', 'Parkscheinautomat',
                             'Zulaessige_Hoechstgeschwindigkeit_50_km_h_274-50',
                             'Verbot_fuer_Fahrzeuge_und_Zuege_ueber_angegebene_tatsaechliche_Laenge_266',
                             'Zulaessige_Hoechstgeschwindigkeit_70_km_h_274-70', 'Gehweg_239',
                             'Zulaessige_Hoechstgeschwindigkeit_80_km_h_274-80', 'Wandererparkplatz_317',
                             'Kreuzung_oder_Einmuendung_102', 'Zulaessige_Hoechstgeschwindigkeit_20_km_h_274-20',
                             'Lichtzeichenanlage_131', 'Verbot_fuer_Fussgaenger_259', 'Vorfahrt_301',
                             'Ende_verkehrsberuhigter_Bereichs_325.2', 'Schleudergefahr_bei_Naesse_oder_Schmutz_114',
                             'Verbot_fuer_Fahrzeuge_ueber_angegebene_tatsaechliche_Hoehe_265',
                             'Ueberholverbot_fuer_Kraftfahrzeuge_mit_einer_zulaessigen_Gesamtmasse_ueber_3,5_t_einschliesslich_ihrer_Anhaenger_und_Zugmaschinen_ausgenommen_PKW_und_Kraftomnibusse_277',
                             'Verbot_fuer_Kraftfahrzeuge_mit_einer_zulaessigen_Gesamtmasse_ueber_3,5_t_einschliesslich_ihrer_Anhaenger_und_Zugmaschinen_ausgenommen_sind_PKW_und_Kraftomnibusse_253',
                             'Vorrang_des_Gegenverkehrs_208', 'Arbeitsstelle_Baustelle_123', 'Halt_Vorfahrt_gewaehren_206',
                             'Verbot_fuer_Fahrzeuge_ueber_angegebenes_tatsaechliches_Gewicht_262',
                             'Zulaessige_Hoechstgeschwindigkeit_10_km_h_274-10',
                             'Zulaessige_Hoechstgeschwindigkeit_30_km_h_274-30',
                             'Beginn_verkehrsberuhigter_Bereich_325.1', 'Bahnuebergang_151', 'Gegenverkehr_125',
                             'Radweg_237', 'Beginn_einer_Tempo_20_Zone_274.1-20', 'Vorfahrt_gewaehren_205',
                             'Schnee_oder_Eisglaette_101-51', 'Zulaessige_Hoechstgeschwindigkeit_120_km_h_274-120',
                             'Zulaessige_Hoechstgeschwindigkeit_100_km_h_274-100', 'Unebene_Fahrbahn_112',
                             'Zusatzzeichen_weiss', 'Zelt_und_Wohnwagenplatz_365-60',
                             'Verbot_fuer_Kraftraeder_auch_mit_Beiwagen_Kleinkraftraeder_Mofas_sowie_fuer_Kraftwagen_und_sonstige_mehrspurige_Kfz_260',
                             'Verbot_fuer_Fahrzeuge_aller_Art_250', 'Zulaessige_Hoechstgeschwindigkeit_40_km_h_274-40',
                             'Zulaessige_Hoechstgeschwindigkeit_60_km_h_274-60']


background_classes = ['Wegweiser_weiss', 'Reifen', 'Hydrant', 'Schildrueckseite_dreieckig_umgedreht', 'Spiegel_eckig',
                      'Pfeilwegweiser_weiss', 'Ankuendigung_blau', 'Spiegel_rund', 'Schildrueckseite_dreieckig',
                      'Schildrueckseite_eckig', 'Radweg_Wegweiser', 'Strassenname_weiss', 'Auto', 'Pfeilwegweiser_gelb',
                      'Ankuendigung_blau_Autobahn', 'Bushaltestelle', 'Richtung_weiss', 'Vorwegweiser_Radverkehr',
                      'Strassenname_blau', 'Schildrueckseite_raute', 'Rueckleuchte', 'Satellitenschuessel', 'Dach_Haus',
                      'Schildrueckseite_rund', 'Wegweiser_gelb', 'Bake', 'Naturschutzgebiet',
                      'Ankuendigung_oder_Fortsetzung_der_Umleitung', 'Ortshinweistafel_1_zeilig_einseitig_385']


unknown_classes = ['Amphibienwanderung_Aufstellung_links_101-24', 'Andreaskreuz_liegend_201-52',
                   'Andreaskreuz_stehend_201-50', 'Andreaskreuz_stehend_mit_Blitzpfeil_201-51', 'Ankuendigungsbake_blau',
                   'Bahn_schwarz_weiss', 'Beginn_einer_Fahrradstrasse_244.1', 'Beginn_einer_Umweltzone_270.1',
                   'Beginn_Fussgaengerzone_242.1', 'Bundesstrassen_401', 'Bussonderfahrstreifen_245',
                   'Durchfahrt_verboten', 'Ende_der_Kraftfahrtstrasse_331.2', 'Ende_einer_Fahrradstrasse_244.2',
                   'Ende_einer_Parkraumbewirtschaftungszone_314.2', 'Ende_einer_Tempo_20_Zone_274.2-20',
                   'Ende_Fussgaengerzone_242.2','Erste_Hilfe_358', 'Gefaelle_108', 'Hund', 'Informationsstelle_365-61',
                   'Kraftfahrtstrasse_331.1', 'Mofas_frei_1022-11', 'not_Germany_not_valid', 'Notrufsaeule_365-51',
                   'ohne_Klasse', 'Parken_nicht_StVO', 'Parken_und_Mitfahren_316-50', 'Parken_und_Reisen_316',
                   'Polizei_363', 'Privatparkplatz', 'Privatweg', 'Reiter_Aufstellung_rechts_101-13',
                   'Sackgasse_fuer_Radverkehr_durchlaessig_357-52', 'Schildrueckseite_hexagon', 'Schildrueckseite_richtung',
                   'Seitenwind_von_links_117-20', 'Seitenwind_von_rechts_117-10', 'Splitt_Schotter_101-52', 'Stau_124',
                   'Steinschlag_Aufstellung_rechts_101-15', 'Tankstelle_mit_Autogas_365-53', 'Taxenstand_229',
                   'Tunnel_mit_Laengenangabe_327-51', 'Verbot_des_Unterschreitens_des_angegebenen_Mindestabstands_273',
                   'Verbot_des_Wendens_272','Verbot_fuer_Fahrzeuge_mit_wassergefaehrdender_Ladung_269',
                   'Verbot_fuer_Fahrzeuge_ueber_angegebene_tatsaechliche_Achslast_263',
                   'Verbot_fuer_Fahrzeuge_ueber_angegebene_tatsaechliche_Breite_264',
                   'Verbot_fuer_kennzeichnungspflichtige_Kraftfahrzeuge_mit_gefaehrlichen_Guetern_261',
                   'Verbot_fuer_Kraftfahrzeuge_ueber_3.5t_und_Kraftomnibusse',
                   'Verbot_fuer_Kraftomnibusse_257-54',
                   'Verbot_fuer_Kraftraeder_auch_mit_Beiwagen_Kleinkraftraeder_und_Mofas_255',
                   'Verbot_fuer_Kraftwagen_und_sonstige_mehrspurige_Kraftfahrzeuge_251',
                   'Verbot_fuer_Mofas_257-50', 'Verbot_fuer_Radverkehr_254', 'Verbot_fuer_Radverkehr_und_Mofas',
                   'Verbot_fuer_Reiter_257-51', 'Verkehrshelfer_356', 'Verkehrszeichen_auf_anderem_Schild',
                   'Viehtrieb_Aufstellung_rechts_101-12', 'Vorgeschriebene_Fahrtrichtung_falsch',
                   'Vorrang_vor_dem_Gegenverkehr_308', 'Vorwegweiser_Fussgaenger', 'Vorwegweiser_LKW', 'Warndreieck',
                   'Warnung_vor_gefaehrlicher_Spannung', 'Warnung_vor_Rutschgefahr', 'Wasser-Schutzgebiet',
                   'Wasserschutzgebiet_354', 'Wegweiser_blau', 'Wohnmobil_blau_Pfeil',
                   'Zulaessige_Hoechstgeschwindigkeit_5_km_h_274-5']


grouped_classes_as_string = ['Halteverbote', 'Parken', 'Ende_von_Restriktionen',
                             'Vorgeschriebene_Fahrtrichtung_Vorbeifahrt', 'Vorfahrtstrasse',
                             'Doppelkurve', 'Einbahnstrasse', 'Verengte_Fahrbahn', 'Fussgaengerueberweg_blau',
                             'Fussgaengerueberweg_rot','Gemeinsamer_Geh_Radweg', 'Getrennter_Rad_und_Gehweg_Radweg',
                             'Kinder', 'Kurve', 'Ortstafel', 'Radverkehr', 'Sackgasse', 'Wildwechsel', 'Leitpfosten']


# check if all classes are still there
c = 0
for i in [Halteverbote, Parken, Ende_von_Restriktionen, Vorgeschriebene_Fahrtrichtung_Vorbeifahrt, Vorfahrtstrasse,
          Doppelkurve, Einbahnstrasse, Verengte_Fahrbahn, Fussgaengerueberweg_blau, Fussgaengerueberweg_rot,
          Gemeinsamer_Geh_Radweg, Getrennter_Rad_und_Gehweg_Radweg, Kinder, Kurve, Ortstafel, Radverkehr, Sackgasse,
          Wildwechsel, Leitpfosten, known_classes_not_grouped]:
    c += len(i)

if c != 124:
    raise Exception('Amount of training classes is not equal to 124')

if len(background_classes) != 29:
    raise Exception('Amount of known training classes is not equal to 29')


def get_label_index(include_background_training_classes, include_unknown_classes):
    '''
    Function creates a dictionary. Key is the class name; Value is integer value.
    :param include_background_training_classes:
    :return:
    '''
    # if background classes are included in training, include those in label_index
    if include_background_training_classes and include_unknown_classes:
        label_list = grouped_classes_as_string + known_classes_not_grouped + background_classes + unknown_classes
    elif include_unknown_classes and not include_background_training_classes:
        label_list = grouped_classes_as_string + known_classes_not_grouped + unknown_classes
    elif not include_unknown_classes and include_background_training_classes:
        label_list = grouped_classes_as_string + known_classes_not_grouped + background_classes
    else:
        label_list = grouped_classes_as_string + known_classes_not_grouped

    label_idx = {l: i for (i, l) in enumerate(label_list)}
    return label_idx


def get_group(cls):
    '''
    Functions checks if class belongs to any group.
    If yes function returns group, if not returns input.
    If input is not part of known classes that are not grouped or of background classes, functions raises error.
    :param cls:
    :return:
    '''
    if cls in known_classes_not_grouped:
        return cls
    elif cls in background_classes:
        return cls

    elif cls in Halteverbote:
        return 'Halteverbote'
    elif cls in Parken:
        return 'Parken'
    elif cls in Ende_von_Restriktionen:
        return 'Ende_von_Restriktionen'
    elif cls in Vorgeschriebene_Fahrtrichtung_Vorbeifahrt:
        return 'Vorgeschriebene_Fahrtrichtung_Vorbeifahrt'
    elif cls in Vorfahrtstrasse:
        return 'Vorfahrtstrasse'
    elif cls in Doppelkurve:
        return 'Doppelkurve'
    elif cls in Einbahnstrasse:
        return 'Einbahnstrasse'
    elif cls in Verengte_Fahrbahn:
        return 'Verengte_Fahrbahn'
    elif cls in Fussgaengerueberweg_blau:
        return 'Fussgaengerueberweg_blau'
    elif cls in Fussgaengerueberweg_rot:
        return 'Fussgaengerueberweg_rot'
    elif cls in Gemeinsamer_Geh_Radweg:
        return 'Gemeinsamer_Geh_Radweg'
    elif cls in Getrennter_Rad_und_Gehweg_Radweg:
        return 'Getrennter_Rad_und_Gehweg_Radweg'
    elif cls in Kinder:
        return 'Kinder'
    elif cls in Kurve:
        return 'Kurve'
    elif cls in Ortstafel:
        return 'Ortstafel'
    elif cls in Radverkehr:
        return 'Radverkehr'
    elif cls in Sackgasse:
        return 'Sackgasse'
    elif cls in Wildwechsel:
        return 'Wildwechsel'
    elif cls in Leitpfosten:
        return 'Leitpfosten'
    else:
        raise ValueError('class of this image does not exist')

